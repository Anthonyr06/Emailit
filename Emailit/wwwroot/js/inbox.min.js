function deleteMsg(){fetch("/Message/Delete",{method:"POST",body:new URLSearchParams({messageId:IdOfMessageToDelete,currentView:currentView}),headers:{RequestVerificationToken:$('input:hidden[name="__RequestVerificationToken"]').val()},redirect:"manual",signal:controller.signal}).then(n=>{if(!n.ok)throw new Error(n.error);return n.text()}).then(()=>{let n="#msg-list-item-"+IdOfMessageToDelete;$(n).removeClass("animate__animated animate__fadeInUpBig");closeOpenedMsg();animateCSS(n,"backOutLeft").then(()=>{$(document).find(n).remove()})}).catch(n=>{n.code!==DOMException.ABORT_ERR&&(console.log(n),alert("Error!! Refresh the page."))}).finally(function(){IdOfMessageToDelete=0;updateInboxReceivedBadge()})}function searchMsg(n){n.length>0&n.length<=100&&(search=n,closeOpenedMsg(),CancelAllFetch(),LoadingAnimationInbox("#msgList",!0),currentView==1?ReceivedInbox(!0):currentView==2&&SentInbox(!0),$("#clearSearchMsgBtn").show("slow"))}function clearSearchMsg(){$("#searchMsgInputTxt").val("");$("#clearSearchMsgBtn").hide();search=""}function CancelAllFetch(){controller.abort();controller=new AbortController}function ReceivedInbox(n,t){$("#TitleMsgListCard > #TitleMsgListCard1").show();$("#TitleMsgListCard > #TitleMsgListCard2").hide();bottomMessageListHasBeenReached=!0;fetch("/Message/Received?"+new URLSearchParams({PageNumber:t,Search:search}),{redirect:"manual",signal:controller.signal}).then(n=>{if(currentPage=n.headers.get("pagination-current-page"),hasNext=n.headers.get("pagination-has-next"),!n.ok)throw new Error(n.error);return n.text()}).then(t=>{n&&$("#msgList").empty(),$("#msgList").append(t)}).catch(n=>{n.code!==DOMException.ABORT_ERR&&(console.log(n),ErrorHasOcurredFetch("#msgList"))}).finally(function(){ActiveListItemInbox("#InboxRecivedMsgBtn");currentView=1;bottomMessageListHasBeenReached=!1;$("#loadingIcon").remove()});updateInboxReceivedBadge()}function addNewReceivedMsg(n){let t=n.itHasAttachedFiles?'&nbsp;<span><img src="/icon/attachBtn.svg" class="mb-1" style="width:1rem;" /><\/span>':"",i='<a href="#" id="msg-list-item-'+n.messageId+'" class="pb-2 list-group-item list-group-item-action custom-right-click msg-list-item animate__animated animate__fadeInUpBig" style="--animate-duration:.7s;">\t\t<div class="d-flex w-100 justify-content-between">            <h6 class="text-truncate">                    <img src="/icon/mail-closed.svg" class="mb-1" style="width:1rem;" />&nbsp;'+n.tittle+t+'            <\/h6>\t\t\t<small class="text-muted" style="font-size:73%;">Right now<\/small>\t\t<\/div>\t\t<p class="block-with-text pb-1">'+n.content+"\t\t<\/p>\t<\/a>";$("#msgList").prepend(i);$("#emptyInbox").hide();updateInboxReceivedBadge()}function updateInboxReceivedBadge(){let n=0;fetch("/Message/Received?"+new URLSearchParams({Handler:"Notseen"}),{redirect:"manual"}).then(n=>{if(!n.ok)throw new Error(n.error);return n.json()}).then(t=>{n=t}).catch(n=>{console.log(n)}).finally(function(){console.log("count: "+n);Number(n)>0?$("#InboxRecivedMsgBtn > span.badge").html(n):$("#InboxRecivedMsgBtn > span.badge").hide()})}function SentInbox(n,t){$("#TitleMsgListCard > #TitleMsgListCard2").show();$("#TitleMsgListCard > #TitleMsgListCard1").hide();bottomMessageListHasBeenReached=!0;fetch("/Message/Sent?"+new URLSearchParams({PageNumber:t,Busqueda:search}),{redirect:"manual",signal:controller.signal}).then(n=>{if(currentPage=n.headers.get("pagination-current-page"),hasNext=n.headers.get("pagination-has-next"),!n.ok)throw new Error(n.error);return n.text()}).then(t=>{n&&$("#msgList").empty(),$("#msgList").append(t)}).catch(n=>{n.code!==DOMException.ABORT_ERR&&(console.log(n),ErrorHasOcurredFetch("#msgList"))}).finally(function(){ActiveListItemInbox("#InboxSentMsgBtn");currentView=2;bottomMessageListHasBeenReached=!1;$("#loadingIcon").remove()})}function LoadingAnimationInbox(n,t){t&&$(n).empty();$(n).append('<div id=loadingIcon class="mt-5 p-3 text-center"><div class="bg-white w-25 mx-auto rounded-pill p-3"><div class="spinner-border text-warning" style="width: 3rem; height: 3rem;" role="status"><span class="sr-only">Loading...<\/span><\/div><\/div> <\/div>')}function ErrorHasOcurredFetch(n){$(n).empty().append('<div class="mt-5 p-3 text-center"><div class="bg-white mx-auto w-75 rounded-pill p-3"><h5 class="pl-2 pt-2"><img src="/icon/error.svg" class="mr-2 mb-1" style="width:3rem;" />Ha ocurrido un error.<\/h5><p class="text-muted">Actualiza la pagina.<\/P><\/div>')}function ActiveListItemInbox(n){$(".list-group-inbox").children().removeClass("active");$(".list-group-inbox > a > span > img").removeClass("white-filter");$(".list-group-inbox > a > span.badge").removeClass("badge-light");$(n).addClass("active");$(n+"> span > img").addClass("white-filter");$(n+"> span.badge").addClass("badge-light")}function OpenMsg(n){$("#OpcionesInboxCol").removeClass("col-xl-2 col-md-3").addClass("col-xl-3");$("#TitleMsgListCard").hide();$("#OpenMessage").addClass("col-7 col-xl");LoadingAnimationInbox("#OpenMessage",!0);fetch("/Message/Details?"+new URLSearchParams({id:n,signal:controller.signal}),{redirect:"manual",signal:controller.signal}).then(n=>{if(!n.ok)throw new Error(n.error);return n.text()}).then(t=>{document.getElementById("OpenMessage").innerHTML=t;let i="#msg-list-item-"+n;$(i+"> div > h6 > img").attr("src","/icon/mail-opened.svg")}).catch(n=>{n.code!==DOMException.ABORT_ERR&&(console.log(n),ErrorHasOcurredFetch("#OpenMessage"))}).finally(function(){setFilesIconOpenedMsg();ActiveMessageListItem("#msg-list-item-"+n);updateInboxReceivedBadge()})}function setFilesIconOpenedMsg(){for(var n=0;n<$(".file-from-open-msg").length;n+=1){let t=$(".file-from-open-msg")[n],i=$(t).data("contenttype");$(".file-from-open-msg").each(function(){if(!i.match("image")){let n=getMimeTypeIconUrl(i);$(t).attr("src",n)}})}}function ActiveMessageListItem(n){$(".msg-list-item").removeClass("active");$(".msg-list-item > div > h6 > img").removeClass("white-filter");$(".msg-list-item > div > h6 > span > img").removeClass("white-filter");$(".msg-list-item > div > small").removeClass("text-muted");$(n).addClass("active");$(n+"> div > h6 >img").addClass("white-filter");$(n+"> div > h6 > span > img").addClass("white-filter")}function closeOpenedMsg(){animateCSS("#OpenMessage","slideOutDown").then(()=>{$("#OpcionesInboxCol").removeClass("col-xl-3").addClass("col-xl-2 col-md-3"),$("#TitleMsgListCard").show(),$("#OpenMessage").removeClass("col-7 col-xl"),$("#OpenMessage").empty(),ActiveMessageListItem(null)})}let MessageIdContextMenu=0,controller=new AbortController,currentView=0;var bottomMessageListHasBeenReached=!1;let currentPage=1,hasNext=!1,search="",IdOfMessageToDelete=0;$(document).ready(function(){LoadingAnimationInbox("#msgList",!0);ReceivedInbox(!0);const n=document.querySelector(".context-menu");let r=$("#msgList"),t=!1;const u={top:r,left:t}=>{n.style.left=`${t}px`,n.style.top=`${r}px`,i("show")},i=i=>{t=i==="show"?!0:!1,n.style.display=t?"block":"none"};$(document).on("contextmenu",".custom-right-click",function(n){n.preventDefault();const t={left:n.pageX,top:n.pageY};MessageIdContextMenu=$(this).attr("id").replace("msg-list-item-","");u(t)});n.addEventListener("contextmenu",function(n){n.preventDefault()});$(window).on("click scroll resize",function(){t&&i("hide")});r.scroll(function(){t&&i("hide")});$("#InboxRecivedMsgBtn").click(function(){closeOpenedMsg();CancelAllFetch();clearSearchMsg();LoadingAnimationInbox("#msgList",!0);ReceivedInbox(!0)});$("#InboxSentMsgBtn").click(function(){closeOpenedMsg();CancelAllFetch();clearSearchMsg();LoadingAnimationInbox("#msgList",!0);SentInbox(!0)});$("#btnSearchMsg").click(()=>{var n=$("#searchMsgInputTxt").val();n&&n.trim()!==""&&searchMsg(n)});$("#searchMsgInputTxt").keyup(function(n){n.keyCode===13&&$("#btnSearchMsg").click()});$("#clearSearchMsgBtn").click(()=>{closeOpenedMsg(),CancelAllFetch(),clearSearchMsg(),LoadingAnimationInbox("#msgList",!0),currentView==1?ReceivedInbox(!0):currentView==2&&SentInbox(!0)});$("#deleteMessageConfirmationBtn").click(()=>{deleteMsg()});$(document).on("click","#btnDeleteFromDetailsMsg",()=>{IdOfMessageToDelete=$("#IdDetailsMsg").val(),console.log("Id: "+IdOfMessageToDelete)});$(document).on("click","#btnDeleteMsgFromContextMenu",()=>{IdOfMessageToDelete=MessageIdContextMenu,console.log("IdC: "+IdOfMessageToDelete)});$("#msgList").scroll(()=>{let n=$("#msgList");n.scrollTop()+n.innerHeight()>=n[0].scrollHeight-20&&hasNext==="True"&!bottomMessageListHasBeenReached&&(bottomMessageListHasBeenReached=!0,console.log("end reached"+currentView),LoadingAnimationInbox("#msgList",!1),currentView==1?ReceivedInbox(!1,Number(currentPage)+1):currentView==2&&SentInbox(!1,Number(currentPage)+1))});$(document).on("click",".msg-list-item",function(n){n.preventDefault();let t=$(this).attr("id").replace("msg-list-item-","");CancelAllFetch();OpenMsg(t)});$(document).on("click","#close-opened-msg",function(){closeOpenedMsg()});$(document).on("mouseenter","#close-opened-msg",function(){$("#img-close-opened-msg").addClass("white-filter")});$(document).on("mouseleave","#close-opened-msg",function(){$("#img-close-opened-msg").removeClass("white-filter")})});