$(document).ready(()=>{function a(){let t=!1,n=r.getValue().toString();return n&&n.trim()!==""||(t=!0),n=$("#MessageTittleTxtInput").val(),n&&n.trim()!==""||(t=!0),$("#summernote").summernote("isEmpty")&&(t=!0),t}function h(){r.clear();e.clear();$("#MessageTittleTxtInput").val("");$("#summernote").summernote("reset");$("#confidentialCheck").prop("checked",!1).change();$("#prioritySelectList").val(0);c()}function v(){let i;$("#newMessageLoadingLogo").show();var t=new FormData;t.append("recipientsId",r.getValue());t.append("ccRecipientsId",e.getValue());t.append("tittle",$("#MessageTittleTxtInput").val());t.append("body",$("#summernote").summernote("code"));t.append("Confidential",$("#confidentialCheck").is(":checked"));t.append("priority",$("#prioritySelectList").val());n.forEach(function(n){t.append("formFiles",n)});fetch("/Message/Create",{method:"POST",body:t,headers:{RequestVerificationToken:$('input:hidden[name="__RequestVerificationToken"]').val()},redirect:"manual"}).then(n=>{if(i=n.headers.get("app-message"),!n.ok)throw new Error(n.error);return n.text()}).then(()=>{i?($("#newMessageModalTxt").html(i),$("#newMessageModal").show()):(h(),$("#NuevoOficioModal").modal("hide"),closeOpenedMsg(),clearSearchMsg(),LoadingAnimationInbox("#msgList",!0),SentInbox(!0))}).catch(n=>{if(n.code!==DOMException.ABORT_ERR){console.log(n);$("#NuevoOficioModal > div").removeClass("modal-xl");$("#NuevoOficioModal .modal-body").html('<div class="mt-5 p-3 text-center"><div class="bg-white mx-auto w-75 rounded-pill p-3"><h5 class="pl-2 pt-2"><img src="/icon/error.svg" class="mr-2 mb-1" style="width:3rem;" />Ha ocurrido un error.<\/h5><p class="text-muted">Actualiza la pagina.<\/P><\/div>')}}).finally(function(){$("#newMessageLoadingLogo").hide()})}function y(t,i){for(var r=0;r<n.length;r++)if(n[r].name==i){t.toggleClass("animate__bounceIn animate__bounceOut");n.splice(r,1);t.on("animationend",()=>{t.remove(),s(),o()});break}}function c(){n=[];$("#file-upload-msg").val("");$("#file-upload-msg-box").children(":not(p)").remove();o();s()}function u(t,i,r=15){n.length<r&&(n.push(t),$("#file-upload-msg-box").append(p(i,t)));n.length>=r&&s(!1);o()}function o(){n.length>0?($("#file-upload-msg-box").children("p").hide(),$("#newMessageAttachmentsBadge").html(n.length),$("#newMessageAttachmentsBadge").show()):($("#file-upload-msg-box").children("p").show(),$("#newMessageAttachmentsBadge").hide())}function s(n=true){let i=$("#file-upload-msg"),t=$('label[for="file-upload-msg"]');i.prop("disabled",!n);t.toggleClass("bg-success",n).toggleClass("bg-secondary",!n);t.css("cursor",n?"pointer":"not-allowed")}function p(n,t){return'<div id="file-added-'+t.name+'" class="col-3 mt-2 animate__animated animate__bounceIn"> <span class="w-25 " style=" position: relative;"><img src="'+n+'" class="w-100" title="'+t.name+'" ><span class="text-white rounded-circle pb-1 px-2 close-doc-file-upload-msg-box" style="display: inline;cursor:pointer; position: absolute; right: -10px; background-color: red;">&times;<\/span><\/span><\/div>'}function l(n){console.log("IdToForward: "+n);$("#newMessageLoadingLogo").show();fetch("/Message/Details?"+new URLSearchParams({id:n,handler:"Json"}),{redirect:"manual"}).then(n=>{if(!n.ok)throw new Error(n.error);return n.json()}).then(n=>{var f;r.clear();e.clear();c();$("#MessageTittleTxtInput").val(n.tittle);$("#confidentialCheck").prop("checked",n.confidential).change();$("#prioritySelectList").val(n.priority);let h=new DOMParser,s=h.parseFromString(n.body,"text/html").documentElement,o=s.getElementsByTagName("img");for(f=0;f<n.attachments.length;f++)$("#file-upload-msg-box").append("<span>&nbsp;Loading...&nbsp;<\/span>");for(f=0;f<n.attachments.length;f++){let r=n.attachments[f];fetch(r.url).then(n=>{if(!n.ok)throw new Error(n.error);return n.blob()}).then(n=>{let f=new File([n],r.nombre,{type:n.type}),s=f.size/1048576;if(s>i)alert("The file "+f.name+" is too large");else if(f.type.match("image")){var e=!1;getBase64FomFile(f,function(n){for(var i=0;i<o.length;i++)o[i].getAttribute("src").indexOf(r.url)>-1&&(e=!0,o[i].src=n,o[i].setAttribute("data-filename",r.nombre));e||u(f,n,t)})}else{let n=getMimeTypeIconUrl(f.type);u(f,n,t)}}).finally(function(){$("#file-upload-msg-box > span:last").remove()})}$("#summernote").summernote("code",s)}).catch(n=>{console.log(n)}).finally(function(){$("#newMessageLoadingLogo").hide()})}const i="20",t="15";$("#summernote").summernote({lang:"en-US",disableResizeEditor:!0,dialogsInBody:!0,dialogsFade:!0,tabDisable:!0,placeholder:"What's up? Write here:)(Required)",tabsize:2,height:250,callbacks:{onInit:function(){$("div.note-editable.card-block").addClass("customScroll1");$(".note-group-image-url").remove();$(".note-image-btn").remove();$(".note-editable").on("click",function(){$(".note-status-output").html("")})},onChange:function(n){let i=$(n).find("img");if(i.length>t){$(".note-status-output").html('<div class="alert alert-danger">Can\'t add more than'+t+" images.<\/div>");let u=i.slice(t,i.length);for(var r=0;r<u.length;r++)n=n.replace(u[r].outerHTML,"");$("#summernote").summernote("code",n)}},onImageUpload:function(n){for(var r=0;r<n.length;r++){let u=n[r];if(u.type.match("image")){let f=u.size/1048576;if(f>i){$(".note-status-output").html('<div class="alert alert-danger">The size of the images should not exceed '+i+"MB.<\/div>");continue}getBase64FomFile(u,function(n){let r=$(".note-editable").find("img");if(r.length>t){$(".note-status-output").html('<div class="alert alert-danger">Can\'t add more than'+t+" images.<\/div>");return}let i=document.createElement("img");$(i).attr({src:n,"data-filename":u.name}).css({width:"25%","max-width":"100%"});$("#summernote").summernote("insertNode",i)})}}}},toolbar:[["style",["style","clear"]],["font",["bold","underline","strikethrough","superscript","subscript"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["forecolor"]],["backcolor",["backcolor"]],["para",["ul","ol","paragraph","height"]],["table",["table","hr"]],["insert",["link","picture"]],["view",["fullscreen","help"]],["misc",["undo","redo"]],]});let f={style:"outline: none !important; box-shadow: none!important; border: 1px solid #DEE2E6!important; -webkit-box-shadow: none!important;",data:"/Message/Create?",method:"get",contentType:"application/json",dataType:"json",dataUrlParams:{handler:"Emails"},queryParam:"search",vtype:"email",displayField:"email",selectionCls:"rounded-pill",hideTrigger:!0,renderer:n=>{let t=n.name+" "+n.lastname;return'<div class="font-weight-bold">'+t+'<\/div><small class="text-black-50">'+n.email+"<\/small>"},valueField:"userId",highlight:!1,placeholder:"Write an email (Required)",noSuggestionText:"No suggestions.",maxSelection:null,required:!0,selectionRenderer:n=>'<img style="width:.9rem;" class="mb-1 mr-1" src="/icon/user-2.svg"/>'+n.email,minChars:3,minCharsRenderer:n=>"Please write "+n+" more letter"+(n>1?"s":"")},r=$("#recipientsTxtInput").magicSuggest(f);f.placeholder=" Write an email";let e=$("#ccRecipientsTxtInput").magicSuggest(f);$(".ms-ctn input").addClass("border-0").attr("autocomplete","ChillOutChrome");$("#confidentialCheck").change(()=>{$("#confidentialCheck").is(":checked")?$("#ConfidencialChkImg").removeClass("textmutedbootstrap-filter"):$("#ConfidencialChkImg").addClass("textmutedbootstrap-filter")});$(document).on("click","#sendMsg",()=>{a()?($("#newMessageModalTxt").html("Fields marked as <strong>(Required)<\/strong> cannot be empty."),$("#newMessageModal").show()):v()});let n=[];$(document).on("click","#newMessageBtn",()=>{h()});$(document).on("click","#newMessageModal > button.close",()=>{$("#newMessageModal").hide()});$("#file-upload-msg").change(r=>{let o=r.target||window.event.srcElement,e=o.files;for(var f=0;f<e.length;f++){let r=e[f],o=r.size/1048576;if(!(n.indexOf(r)>-1)){if(o>i){alert("The file "+r.name+" is too large");continue}if(r.type.match("image"))getBase64FomFile(r,function(n){u(r,n,t)});else{let n=getMimeTypeIconUrl(r.type);u(r,n,t)}}}$("#file-upload-msg").val("")});$(document).on("click",".close-doc-file-upload-msg-box",function(){let n=$(this).parent().parent(),t=$(this).siblings("img").attr("title"),i="#"+n.attr("id");console.log(i);y(n,t)});$(document).on("click","#btnForwardFromDetailsMsg",()=>{l($("#IdDetailsMsg").val())});$(document).on("click","#btnForwardFromContextMenu",()=>{l(MessageIdContextMenu)})});